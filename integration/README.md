# Test Script For go-cve-dictionary
Documentation on testing for developers

## Getting Started
```terminal
$ pip install -r requirements.txt
```

## Run test
Use `127.0.0.1:1325` and `127.0.0.1:1326` to diff the server mode between the latest tag and your working branch.

If you have prepared the two addresses yourself, you can use the following Python script.
```terminal
$ python diff_server_mode.py --help

```

[GNUmakefile](../GNUmakefile) has some tasks for testing.  
Please run it in the top directory of the go-cve-dictionary repository.

- build-integration: create the go-cve-dictionary binaries needed for testing
- clean-integration: delete the go-cve-dictionary process, binary, and docker container used in the test
- fetch-rdb: fetch data for RDB for testing
- fetch-redis: fetch data for Redis for testing
- diff-cveid: Run tests for CVE-ID in server mode
- diff-cpes: Run tests for CPE in server mode
- diff-server-rdb: take the result difference of server mode using RDB
- diff-server-redis: take the result difference of server mode using Redis
- diff-server-rdb-redis: take the difference in server mode results between RDB and Redis

## About the CVE-ID and CPE_URI used for testing
Duplicates are removed from the latest fetched data and prepared.  
For example, for sqlite3, you can get it as follows.  

```terminal
$ sqlite3 cve.sqlite3
SQLite version 3.31.1 2020-01-27 19:55:54
Enter ".help" for usage hints.
# CVE-ID
sqlite> .output integration/nvd_cves.txt
sqlite> SELECT DISTINCT cve_id FROM nvds;
sqlite> .output integration/jvn_cves.txt
sqlite> SELECT DISTINCT cve_id FROM jvns;

# CPE URI
sqlite> .output integration/nvd_cpes.txt
sqlite> SELECT DISTINCT uri FROM nvd_cpes;
sqlite> .output integration/jvn_cpes.txt
sqlite> SELECT DISTINCT uri FROM jvn_cpes;

$ cat integration/nvd_cves.txt integration/jvn_cves.txt | sort | uniq > integration/cves.txt
$ rm integration/nvd_cves.txt integration/jvn_cves.txt
$ cat integration/nvd_cpes.txt integration/jvn_cpes.txt | sort | uniq > integration/cpes.txt
$ rm integration/nvd_cpes.txt integration/jvn_cpes.txt
```
